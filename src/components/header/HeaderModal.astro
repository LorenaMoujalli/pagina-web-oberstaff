<div id="menuModal" class="menu-modal">
  <div class="modal-backdrop" id="modalBackdropMenu"></div>
  <div class="modal-content">
    <div class="modal-header">
      <img src="/images/logo.png" alt="Logo" class="modal-logo" />
      <button id="closeMenuBtn" class="close-btn" aria-label="Cerrar">×</button>
    </div>

    <nav class="modal-links">
      <a href="#que-hacemos">¿Qué hacemos?</a>
      <a href="#como-funciona">¿Cómo funciona?</a>
      <a href="#testimonios">Testimonios</a>
      <a href="#preguntas-frecuentes">Preguntas frecuentes</a>
      <a href="#contacto">Contacto</a>
      <a href="https://oberstaff.com/blog">Blog</a>
      <a href="/empleos">¿Buscas trabajo?</a>
    </nav>
  </div>
</div>

<div id="contactModal" class="menu-modal">
  <div class="modal-backdrop" id="modalBackdropContact"></div>
  <div class="modal-content contact-content">
    <div class="modal-header">
      <img src="" alt="" class="modal-logo" />
      <button id="closeContactBtn" class="close-btn" aria-label="Cerrar">×</button>
    </div>

    <h2>Envíanos <span class="mensaje">un mensaje</span></h2>
    <p>Envíanos tus dudas y te responderemos lo más pronto posible.</p>

    <form id="webhookFormModal" class="contact-form-modal">
      <input type="text" name="nombre" placeholder="Nombre y apellido" required />
      <input type="email" name="email" placeholder="Email" required />

      <div class="phone-group">
        <input type="text" name="codigoPais" placeholder="+XX" class="country-code" required />
        <input type="text" name="telefono" placeholder="Teléfono" class="phone-number" required />
      </div>

      <textarea name="mensaje" placeholder="Mensaje" rows="4" required></textarea>

      <button type="submit" class="btn-send">ENVIAR MENSAJE</button>
    </form>
  </div>
</div>

<script type="module">
  const openMenuBtn = document.getElementById("openMenuBtn");
  const closeMenuBtn = document.getElementById("closeMenuBtn");
  const menuModal = document.getElementById("menuModal");
  const backdropMenu = document.getElementById("modalBackdropMenu");

  const openContactBtn = document.getElementById("openContactBtn");
  const closeContactBtn = document.getElementById("closeContactBtn");
  const contactModal = document.getElementById("contactModal");
  const backdropContact = document.getElementById("modalBackdropContact");

  function openModal(modal) {
    modal.classList.add("show");
    document.body.style.overflow = "hidden";
  }

  function closeModal(modal) {
    modal.classList.remove("show");
    document.body.style.overflow = "";
  }

  openMenuBtn.addEventListener("click", () => openModal(menuModal));
  closeMenuBtn.addEventListener("click", () => closeModal(menuModal));
  backdropMenu.addEventListener("click", () => closeModal(menuModal));

  openContactBtn.addEventListener("click", () => openModal(contactModal));
  closeContactBtn.addEventListener("click", () => closeModal(contactModal));
  backdropContact.addEventListener("click", () => closeModal(contactModal));

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      closeModal(menuModal);
      closeModal(contactModal);
    }
  });

  const menuLinks = document.querySelectorAll(".modal-links a");
  menuLinks.forEach((link) => {
    link.addEventListener("click", () => closeModal(menuModal));
  });

  const WEBHOOK_URL = "https://n8n.obertrack.com/webhook-test/contacto";
  const formModal = document.getElementById("webhookFormModal");

  if (formModal) {
    formModal.addEventListener("submit", async function (event) {
      event.preventDefault();

      const telefonoCompleto = formModal.codigoPais.value + formModal.telefono.value;

      const data = {
        nombres: formModal.nombre.value,
        apellidos: "",
        email: formModal.email.value,
        telefono: telefonoCompleto,
        mensaje: formModal.mensaje.value,
      };

      try {
        const response = await fetch(WEBHOOK_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });

        if (response.ok) {
          formModal.reset();
        }
      } catch (error) {
        console.error("Error:", error);
      }
    });
  }
</script>
